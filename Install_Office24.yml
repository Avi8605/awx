---
- name: התקנת Office 2024 מהתקן רשת
  hosts: all
  gather_facts: false

  vars:
    share_path: '\\132.72.48.201\installations'
    product_folder: 'Microsoft Office LTSC 2024'
    dest_folder: 'C:\Office2024'
    setup_file: 'setup.exe'
    config_file: 'Office2024.xml'

  tasks:

    - name: יצירת תיקיית יעד להתקנה
      win_file:
        path: "{{ dest_folder }}"
        state: directory

    - name: העתקת setup.exe מהשיתוף
      win_shell: |
        net use {{ share_path }} /user:auth\{{ ansible_user }} "{{ ansible_password }}"
        if %ERRORLEVEL%==0 (
          copy "{{ share_path }}\{{ product_folder }}\{{ setup_file }}" "{{ dest_folder }}\{{ setup_file }}"
        ) else (
          exit /b 1
        )
      args:
        executable: cmd
      no_log: false

    - name: העתקת Office2024.xml מהשיתוף
      win_shell: |
        net use {{ share_path }} /user:auth\{{ ansible_user }} "{{ ansible_password }}"
        if %ERRORLEVEL%==0 (
          copy "{{ share_path }}\{{ product_folder }}\{{ config_file }}" "{{ dest_folder }}\{{ config_file }}"
        ) else (
          exit /b 1
        )
      args:
        executable: cmd
      no_log: false

    - name: הרצת setup.exe עם קובץ ההגדרות
      win_command: "{{ dest_folder }}\\{{ setup_file }} /configure {{ dest_folder }}\\{{ config_file }}"
      args:
        chdir: "{{ dest_folder }}"
      register: install_result

    - name: פלט התקנה
      debug:
        var: install_result.stdout
